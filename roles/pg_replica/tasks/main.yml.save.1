- name: "Create a backup directory"
  file:
    path: "/backups"
    state: directory
    recurse: yes

- name: "Back up the database"
  postgresql_db:
    state: dump
    name: "{{ db_name }}"
    target: "{{ app_name }}/backups/{{ ansible_date_time.date }}/{{ db_name }}.dump.gz"
  become: true
  become_user: postgres
